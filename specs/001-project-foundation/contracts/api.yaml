# API Contracts: 프로젝트 기초 생성

## RESTful API Endpoints

### Authentication (인증)
Supabase Auth를 통해 처리되므로 별도 API 엔드포인트 불필요

### Users (사용자 관리)
#### Get Current User Profile
```yaml
GET /api/users/me
Authorization: Bearer {jwt_token}

Response 200:
  id: string
  email: string
  nickname: string
  avatarUrl?: string
  createdAt: string (ISO 8601)
  updatedAt: string (ISO 8601)
```

#### Update User Profile
```yaml
PUT /api/users/me
Authorization: Bearer {jwt_token}
Content-Type: application/json

Request Body:
  nickname: string (2-20 chars)
  avatarUrl?: string (valid URL)

Response 200:
  id: string
  email: string
  nickname: string
  avatarUrl?: string
  createdAt: string
  updatedAt: string
```

### Game Rooms (게임 방 관리)
#### Create Game Room
```yaml
POST /api/rooms
Authorization: Bearer {jwt_token}
Content-Type: application/json

Request Body:
  name: string (1-50 chars)
  maxPlayers: number (2-10, default: 6)

Response 201:
  id: string (6-character code)
  hostId: string
  name: string
  maxPlayers: number
  currentPlayers: number
  status: 'waiting'
  createdAt: string
  updatedAt: string
```

#### Get Available Rooms
```yaml
GET /api/rooms?status=waiting&limit=20

Response 200:
  - id: string
    name: string
    maxPlayers: number
    currentPlayers: number
    status: string
    createdAt: string
```

#### Get Room Details
```yaml
GET /api/rooms/{roomId}
Authorization: Bearer {jwt_token}

Response 200:
  id: string
  hostId: string
  name: string
  maxPlayers: number
  currentPlayers: number
  status: string
  players:
    - id: string
      userId: string
      nickname: string
      avatarUrl?: string
      isHost: boolean
      joinedAt: string
  createdAt: string
  updatedAt: string

Response 404:
  error: "Room not found"
```

#### Join Room
```yaml
POST /api/rooms/{roomId}/join
Authorization: Bearer {jwt_token}

Response 200:
  playerId: string
  roomId: string
  isHost: boolean
  joinedAt: string

Response 400:
  error: "Room is full"

Response 404:
  error: "Room not found"
```

#### Leave Room
```yaml
DELETE /api/rooms/{roomId}/leave
Authorization: Bearer {jwt_token}

Response 200:
  message: "Left room successfully"

Response 404:
  error: "Room not found or you are not in this room"
```

## WebSocket Events (Socket.IO)

### Connection
```yaml
Event: connect
Data:
  token: string (JWT from Supabase)
```

### Room Events
#### Join Room
```yaml
Client → Server: 'join-room'
Data:
  roomCode: string

Server → Client: 'room-joined'
Data:
  room: GameRoom
  player: RoomPlayer
```

#### Leave Room
```yaml
Client → Server: 'leave-room'
Data: {}

Server → Client: 'room-left'
Data:
  playerId: string
```

#### Player Updates
```yaml
Server → Client: 'player-joined'
Data:
  player: RoomPlayer

Server → Client: 'player-left'
Data:
  playerId: string
```

#### Room Status Updates
```yaml
Server → Client: 'room-updated'
Data:
  room: GameRoom
```

### Error Handling
```yaml
Server → Client: 'error'
Data:
  code: string
  message: string
  details?: any
```

## Data Models

### User
```typescript
interface User {
  id: number;           // Auto Increment Unsigned Integer
  supabaseId: string;  // Supabase UUID
  email: string;
  nickname: string;
  avatarUrl?: string;
  createdAt: string;
  updatedAt: string;
}
```

### GameRoom
```typescript
interface GameRoom {
  id: number;           // Auto Increment Unsigned Integer
  roomCode: string;     // 6자리 방 코드
  hostId: number;
  name: string;
  maxPlayers: number;
  currentPlayers: number;
  status: 'waiting' | 'playing' | 'finished';
  createdAt: string;
  updatedAt: string;
}
```

### RoomPlayer
```typescript
interface RoomPlayer {
  id: number;           // Auto Increment Unsigned Integer
  roomId: number;
  userId: number;
  nickname: string;
  avatarUrl?: string;
  isHost: boolean;
  joinedAt: string;
  isActive: boolean;
}
```

## Error Codes

### HTTP Status Codes
- `200`: Success
- `201`: Created
- `400`: Bad Request
- `401`: Unauthorized
- `403`: Forbidden
- `404`: Not Found
- `500`: Internal Server Error

### WebSocket Error Codes
- `ROOM_NOT_FOUND`: 방을 찾을 수 없음
- `ROOM_FULL`: 방이 가득 참
- `UNAUTHORIZED`: 인증 실패
- `INVALID_DATA`: 데이터 형식 오류
- `INTERNAL_ERROR`: 내부 서버 오류